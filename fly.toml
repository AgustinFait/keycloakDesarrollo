app = "keycloak-app"

primary_region = "gru"

[build]
  image = "quay.io/keycloak/keycloak:26.4.4"

[env]
  KC_DB = "dev-mem"
  KC_METRICS_ENABLED = "false"
  KC_HEALTH_ENABLED = "false"
  KC_PROXY = "edge"
  KC_HOSTNAME_STRICT = "false"
  KC_HTTP_RELATIVE_PATH = "/"
  KC_HTTP_ENABLED = "true"
  KC_HTTP_PORT = "8080"

  # Limitar JVM para Fly.io (256â€“320 MB)
  JAVA_OPTS = "-XX:+UseSerialGC -Xms128m -Xmx320m"

[[services]]
  internal_port = 8080
  processes = ["app"]
  protocol = "tcp"

  [[services.ports]]
    port = 80
    handlers = ["http"]

  [[services.ports]]
    port = 443
    handlers = ["tls", "http"]

  [services.concurrency]
    hard_limit = 20
    soft_limit = 10
    type = "connections"

[mounts]
  source = "keycloak_data"
  destination = "/opt/keycloak/data"

[processes]
  app = ["/opt/keycloak/bin/kc.sh", "start", "--optimized"]
